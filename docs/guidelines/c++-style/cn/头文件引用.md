---
name: "project-cpp-header-inclusion"
description: "OpenCTK项目C++头文件引用风格。在编写OpenCTK C++代码时调用，以遵循项目的头文件引用规则。"
---

# OpenCTK 项目 C++ 头文件引用风格指南

[English Version](../header-inclusion.md)

## 概述

本文档描述了 OpenCTK 项目中使用的 C++ 头文件引用规范。遵循这些规范可以确保代码库的一致性，提高代码的可读性和可维护性。

## 核心原则

1. **一致性**：在整个项目中遵循相同的引用顺序
2. **清晰性**：明确每个头文件的来源
3. **避免污染**：尽量减少不必要的引用
4. **依赖管理**：只引用直接使用的头文件
5. **构建性能**：优化引用顺序以减少编译时间

## 头文件引用语法

### 1. 本地项目头文件（同一模块）

- **语法**：使用双引号（`""`）
- **使用场景**：同一模块或组件内的头文件
- **示例**：
  ```cpp
  #include "octk_string_utils.hpp"
  ```

### 2. 项目全局头文件

- **语法**：使用尖括号（`<>`）
- **使用场景**：项目范围内的头文件，已在包含路径中
- **示例**：
  ```cpp
  #include <octk_global.hpp>
  #include <octk_checks.hpp>
  ```

### 3. 私有实现头文件

- **语法**：使用带 `private/` 前缀的尖括号
- **使用场景**：不对外暴露的内部实现细节
- **命名规范**：私有头文件使用 `_p.hpp` 后缀
- **示例**：
  ```cpp
  #include <private/octk_svc_rate_allocator_p.hpp>
  #include <private/octk_scalability_mode_p.hpp>
  ```

### 4. 标准库头文件

- **语法**：使用尖括号（`<>`）
- **使用场景**：C++ 标准库头文件
- **示例**：
  ```cpp
  #include <sstream>
  #include <algorithm>
  #include <vector>
  ```

### 5. 第三方库头文件

- **语法**：使用双引号（`""`）
- **使用场景**：外部库头文件（如 Abseil、WebRTC）
- **示例**：
  ```cpp
  #include "absl/strings/string_view.h"
  #include "api/transport/rtp/dependency_descriptor.h"
  ```

### 6. 系统头文件

- **语法**：使用尖括号（`<>`）
- **使用场景**：操作系统或编译器特定的头文件
- **示例**：
  ```cpp
  #include <wels/codec_app_def.h>
  #include <wels/codec_api.h>
  ```

## 引用顺序

头文件应按照以下顺序引用，以最小化依赖并提高构建性能：

1. **同一模块本地头文件**（使用双引号）
2. **私有实现头文件**（使用 `<private/...>`）
3. **项目全局头文件**（使用尖括号）
4. **第三方库头文件**（使用双引号）
5. **标准库头文件**（使用尖括号）
6. **系统头文件**（使用尖括号）

### 正确引用顺序示例

```cpp
// 1. 同一模块本地头文件
#include "octk_string_utils.hpp"

// 2. 私有实现头文件
#include <private/octk_some_feature_p.hpp>

// 3. 项目全局头文件
#include <octk_global.hpp>
#include <octk_checks.hpp>

// 4. 第三方库头文件
#include "absl/strings/string_view.h"

// 5. 标准库头文件
#include <sstream>
#include <algorithm>
#include <cctype>
#include <iomanip>

// 6. 系统头文件
#include <wels/codec_app_def.h>
```

## 分组引用

- **按类别分组**：不同类别的头文件之间用空行分隔
- **每组内排序**：每组内的头文件按字母顺序排序
- **避免重复引用**：不要多次引用同一个头文件

### 分组和排序引用示例

```cpp
// 同一模块
#include "octk_video_encoder_openh264.hpp"

// 私有头文件
#include <private/octk_h264_bitstream_parser_p.hpp>
#include <private/octk_simulcast_utility_p.hpp>
#include <private/octk_video_encoder_openh264_p.hpp>

// 项目头文件
#include <octk_metrics.hpp>
#include <octk_simulcast_rate_allocator.hpp>
#include <octk_video_type.hpp>

// 标准库
#include <algorithm>
#include <cmath>
#include <memory>
#include <vector>
```

## 前向声明

- **尽可能使用前向声明**：减少编译依赖
- **在头文件中声明**：将前向声明放在头文件开头
- **使用正确的命名空间**：在前向声明中使用正确的命名空间

### 前向声明示例

```cpp
// 前向声明
namespace webrtc
{
class VideoFrame;
}

namespace octk
{
class VideoEncoder;
}

// 前向声明后跟随引用
#include <octk_global.hpp>
// ...
```

## 头文件保护

- **使用 #pragma once**：首选，简洁且速度快
- **替代方案**：使用传统的包含保护，以获得最大兼容性
- **命名规范**：`_PROJECT_NAME_FILENAME_HPP`（全部大写，下划线分隔）

### 示例

**#pragma once（首选）**：
```cpp
#pragma once

// 头文件内容
```

**传统包含保护**：
```cpp
#ifndef _OCTK_STRING_UTILS_HPP
#define _OCTK_STRING_UTILS_HPP

// 头文件内容

#endif // _OCTK_STRING_UTILS_HPP
```

## 最佳实践

1. **只引用直接使用的头文件**：不要引用不直接使用的头文件
2. **避免循环引用**：重构代码以消除循环依赖
3. **使用前向声明**：减少编译时间和依赖
4. **最小化头文件大小**：保持头文件专注且小巧
5. **不要在头文件中使用 using namespace**：避免污染全局命名空间
6. **文档化依赖**：为有特定要求的引用添加注释
7. **遵循项目的引用顺序**：一致性是关键

## 常见错误避免

1. **引用顺序错误**：这可能导致编译错误或增加构建时间
2. **使用错误的引用语法**：为标准库头文件使用引号或为本地头文件使用尖括号
3. **未排序引用**：使查找和维护引用变得困难
4. **过度引用**：增加编译时间并创建不必要的依赖
5. **循环引用**：可能导致编译错误并使代码难以维护
6. **使用相对路径引用**：避免使用 `../header.hpp` 样式的引用
7. **未在可能的情况下使用前向声明**：增加编译时间

## 结论

遵循这些头文件引用指南可以确保 OpenCTK 项目中 C++ 代码的一致性、可维护性和构建效率。正确的头文件管理可以减少编译时间，最小化依赖，并使代码库更易于维护。

在做出引用决策时，请始终考虑其对构建性能和代码可维护性的影响。如有疑问，请遵循代码库中已有的模式。

[English Version](../header-inclusion.md)